# 现在有很多思路，但是好多都是不行的
# 所以我打算先走 Proxifier 的思路。
# 他们都说老版本是 lsp 拦截技术，或者是 winsock dll hook。
# 但是老版本的技术过于丑陋，会导致cpu飙升。
# 所以新方法是 在R0层通过过滤驱动的方式，劫持了A.exe进程发送的数据包

前期尝试:
  Fidder: 设置系统代理，设置为 Fidder 的8888端口。 # 所以没用
  Npcap: 
    - 失败了 # 因为只能获取包，不能拦截包。
    - 好像 Wireshark都不能拦截? # https://www.zhihu.com/question/296876516
  TUN: 有待尝试，因为过于丑陋，优先级并不高。
  R0层通过过滤驱动的方式: # 尝试中。
    寒江独钓: 先学习这本书。
  
Todo: # 用WFPSample项目实现一次我想要实现的。
  网络拦截:
    2023年10月10日: 尽量搞定双机调试
    2023年10月12日: 完成个屁，昨天都没时间搞，今天看看能不能搞双机调试吧。
    2023年10月13日: 太难啦！昨天搞了俩小时都没搞定，今天看看有没有时间搞吧。 | 虚拟机启动突然变的特别慢 | 双机调试好像是成功了
    2023年10月16日: 虚拟机依然很慢，需要解决。 # 这几天实在不想学习，哎，慢慢来吧！
    2023年10月17日: 虚拟机启动慢好像是因为 Windbg 的原因？还是开了 debug pipe的原因。正在研究加断点，今天也很忙。| 虚拟机启动慢是因为 debug on.
    2023年10月18日: 今天一直在工作浪费生命，还是下次不忙的时候再搞吧。 | 回到家看了会儿 Windbg 调试普通c++程序的视频。明天继续看吧。
    2023年10月19日: 浪费生命 Too | 准备回家，明天继续。
    2023年10月23日: 好困啊，今天任务是工作、好好睡觉。
    2023年10月24日: 一整天都在工作，九点下班，压根没有时间学习别的东西，这个月就这样吧先。
    2023年10月25日: AndroidStudio格式化突然出问题，疯狂搞我心态，然后我登录QQ的时候，突然自动安装QQ play，把我心态搞炸了。八点下班，累死，回家尽量学习。
    2023年10月26日: Loading贼慢，没法解决，照常无薪免费加班到七点半，这次回家必须得学习，你没时间再玩了！妈的！但是今天找到了一个网络过滤的开源，得好好研究一下。没想到加班到了九点十分钟，该走了，不然跑步都跑不了。他妈的还是免费加班草！
    2023年10月27日: 憋屎大赛，开始！那个开源的代码我成功编译出来了，我打算在Windows 7 32位系统中尝试安装一下，看看效果。真的可以啊！好厉害！从现在开始研究这个代码的原理。我压根看不懂代码啊，还是看书吧，慢慢啃，先打基础。
    2023年10月29日: 学习！睡着了，浪费一周，法克！晚上吃完饭，学习到12点，不管学什么，学！开始！先在JD买了Windows内核安全与驱动开发电子书。慢慢看！他妈的，居然不能离线阅读，真他吗服拉，我曹！算了，懒得退款了，而且好像就是不能退款，真的恶心，慢慢看吧，懒得追究。因为好多琐事耽误了学习，现在休息吧，12点有点理想了，得留下睡着的时间。
    2023年10月30日: 学习！学个屁！搞了一个超级难搞的bug，搞到五点，还得做别的工作，慢慢来吧！今天浪费一天在工作中，明天一定要好好学习！看看能不能学吧。困了！但是！继续加油！跟着书抄写！你真的很努力了！加油！抄的代码一直蓝屏，明天再看吧，感觉不会短时间内解决。
    2023年10月31日: 学习！之后发现蓝屏的原因是我忽略警告和wdk版本不一致的原因，该工作了，哎！工作了大半天累死我了。又得修BUG，服啦！！加班加了一个小时！！！！！fuck！！！回家！！！再也不看视频了！！睡觉！
    2023年11月01日: 好好工作，把问题解决一下。加班到八点，最终还是问了组长才解决，果然组长还是牛逼！以后有问题就先问别人先。今天好好休息！
    2023年11月02日: 再也不看视频，好好整理昨天的东西，把工作完成，然后学习！有时间就慢慢咀嚼驱动代码的意思，慢慢消化。今天又是干了一天的活，累死！回家好好看下书，抄下代码。好困好累，但是坚持一会儿吧，好吗？今天确实没有看视频，但是中途吃东西洗澡发呆导致效率不高，而且很困很困，但是也已经很好了，真的！我为你骄傲，嘿嘿，稍微再看会儿睡觉吧。
    2023年11月03日: 先工作，后学习。蓝屏到自闭，又回到研究调试了，但是之前不是调试太卡嘛，这次让他不卡为目标，搞！解决了，还是得大佬啊！！明天用调试把蓝屏解决一下。
    2023年11月04日: 学习！蓝屏解决！困到爆，现在研究代码，但是好难啊，压根看不懂，哎，慢慢来。我发现越到后面就越看不懂了，代码也懒得复制粘贴编译了！或许我不适合学习？只能说再试试几个月，不行就算了吧！今天就到此为止，明天继续吧，主要是我觉得可以开始搞一个网络过滤驱动了。当然，其实就是想休息玩游戏了。。
    2023年11月05日: 昨儿忘了，今天要出去吃饭的，只能晚上学习了。刚刚困的要死，睡了一觉，感觉现在也很困。我没法坚持了，我要玩游戏了！不知道为啥，今天好烦躁啊，总是想看视频！我受不了了！再坚持会儿！学习就先算了吧，先稳住不看视频。
    2023年11月06日: 我昨天失眠了，我要不要睡觉的时候不要听小说？哎！试试吧。先把这些东西搞定。搞定个屁！我太在乎了，压根别在意即可。又浪费了一天，而且还自愿加班了，而且还没解决问题，哈哈哈哈哈哈！草！
    2023年11月07日: 好累，最近。浪费一整天，回家好好休息，我就满足了。
    2023年11月08日: CV大法。NdisPortFilteringDriver因为win10不支持ndis5所以没法正常运行，WfpFilteringDriverByOther这别人写的例子里面没有数据包怎么获取的概念所以下一个，中途因为拉稀导致我一直搜药相关的浪费大量时间。还是尽量看微软官方英文文档吧，下载了微软驱动代码，编译试试！编译WFPSampler。好难懂，看了好久，但是没看懂，再看会儿。慢慢看就行啦，不用太着急。好嘞，今天又没学习，明天开始不看视频了。
    2023年11月09日: 又失眠了，打算今天开始禁止一切娱乐，坚持到来年，简单是吧？每天只睡7个小时试试。今天的话好好搞懂WFPSampler，但是不用太尽力，因为现在重要的是睡眠，而且工作也得干。一直在工作，从未停歇，好困啊，今天感觉没法看代码了。一直在工作！虽然困得要死，但是稍微再看一会儿吧，今天还有HR找我，但是我知道，不会有结果的，好好学习才是硬道理！困得要晕倒，要克服失眠！
    2023年11月10日: 工作了一天，刚刚又来劝我，我很感动，这么多人关心我，我有什么理由不能死？加油吧！我发现还是得读readme，发现得把所有的东西都编译才能正常使用，我说驱动开了啥反应都没有。
    2023年11月11日: 玩了一天。
    2023年11月12日: 今天开始吧...自律太难了！搞了一会儿还是没搞好，算了吧，慢慢来。妈的，我又看半天视频，我周末就他妈的净看视频了。这样吧，真的，这次真的挑战一下不看视频到这一年结束吧，尝试一下怎么样？......好，明天的任务是解决mpssvc服务staring&&stoping个不停的问题，然后让WFPSampler顺利的启动。
    2023年11月13日: 计划很美好，但是现实很残酷，我工作了一整天，浪费了一整天，坚持不看视频，回家再看看吧，慢慢来。我排查了一下，好像是系统的问题，我还得慢慢搞，但是我先用一下WFPSampler，看看效果。成功了，得好好总结，好好整理，然后进行下一步。下一步目标是让它在非testMode下运行。今天做的好，但是我知道后续会更难坚持下去，但是努力，我们可以的。看看别人的驱动是怎么过的，比如OpenArk.
    2023年11月14日: 工作一整天，太忙了，压根没时间休息，哎！浪费！得再加会儿班。八点下班不知道为什么到家就九点，好累，啥都没干。就下了几个文件，整理了下东西。打算编译openark.
    2023年11月15日: 最近真的是太忙了，而且睡眠质量极差！我会不会猝死，没事，慢慢来，毕竟我已经决定不看视频了，这是一个好消息，我如同宇宙中的尘埃，无所谓了。最近太忙了，也好累，整理文件吧。文件也忒多了吧！不行了，太困了。
    2023年11月16日: 今天没学习，懒得学，好多bug也没能解决，而且手机没信号，挑了半天，没事，买了个垃圾也没事，会好起来的，之后再给你买新的，我知道，慢慢来吧，我知道你很难受，但是没事的。今天又是整理文件，突然想到网盘，搞了个挂载，感觉没多大用。
    2023年11月18日: 这几天啥都没干，就玩。
    2023年11月20日: 昨天也是，该改变了。我昨天吃了一个鸡排，现在都恶心，刚刚差点吐了，哎，先养病吧。我觉得还是自己给自己的压力太大了，但是我确实也不知道该怎么解决自律问题。今天搞了qt的build，太难了，我搞了一天都没搞定，我是不是不适合build啊。
    2023年11月21日: 今天又是工作的一天，疯狂拉稀，朋友让我吃药，我吃了，或许会好点，我发现群里有qt的build的文件，就不编译了，发现好难。直接用他的编译出来再说。
    2023年11月22日: 今天也很恶心，但是好多了，继续吃药，openark编译出来了，发现没有签名，还是需要免签名，所以我觉得openark并没有签名的代码，或许是被作者所占有，所以我还是开发吧，先别搞签名了。正式开始驱动开发。搞了半天都没法让log打出来，明天在搞吧。
    2023年11月23日: 计划，计划，计划，工作完成后研究DbgPrintEx为啥打不出。研究了，没解决，我是真没想到这玩意这么复杂！搞好了，服了，不是很好整。之后开始研究脉络，然后实现域名拦截系统。
    2023年11月24日: 颈椎开始疼，又失眠，又消化不行，太难啦！工作基本搞定，正式开始开发。看到英文尽量不要先翻译，而是先看一遍，再翻译。现在的唯一目标就是获取包里的数据。
    2023年11月27日: 颈椎疼，感冒，各种debuff，好难受。我该准备出路了。开始搜索到底怎么修改数据包，在wfpSampler中是很难找到的，所以我打算搜索，或者看雪中提问。找到了，果然还是得善用搜索引擎，但是有很多bug，还是得慢慢来。
    2023年11月28日: 颈椎疼，感冒，今天开始解决为什么有的打不出来，是？？？这种乱码之类的。还是不清楚，我打算还是搞ndis，wfp差不多就行了。。我发现为啥乱码了，是因为有些不是abcd啥的，然后还有00，所以直接截断，后面的东西就不显示了，说明是有效果的！获取了数据包，突然感觉无趣，虽然本身是很简单，但确实耗费了好久好久，耗费了我两个月的时间。我再好好补充一下网络驱动相关的知识吧，明天再继续搞别的。我仔细想了想，要不还是走hook的方向走走吧，因为毕竟得用上驱动，驱动就得有签名，所以明天开始整api的hook试试，全局hook啥的，慢慢来吧，嘿嘿。先从不需要签名认证的普通程序尝试，以后有钱了之后买一个商铺之后创立公司之后再弄驱动吧，先搞hook啥的，委屈你了。
    2023年11月29日: 颈椎照样疼，感冒稍微好点，最近睡眠好多，今天搞注入还挺好玩。
    2023年11月30日: 今天一直在工作。回家寻找一下家庭控制的软件，然后控制我自己，然后自己开发出一个。别人开发的家庭控制软件都不合心意。
    2023年12月01日: 今天也一直在工作，稍微搞搞hook吧。继续搞启动技术。
    2023年12月04日: 不搞启动技术，直接实现一下吧，不管多么丑陋，先开始。脑子里也别想什么，直接开始。时间很紧凑了，不要思考，疯狂搞。突然发现一个bug，正在修，还有就是没有hook到chrome的带域名的函数，WFASend是hook到了，找找看能不能搞出域名来。
    2023年12月05日: 工作。一直在工作。今天开始不再看视频。今天看到禁用ipv6可以截取到baidu的域名，得解决ipv6。今天很有进步，我知道这是因为第一天的原因，但是我还是很欣慰。加油，我们可以的。
    2023年12月06日: 工作。一直在工作，稍微有点时间看了下拦截域名，我发现在公司ipv4是没问题，ipv6好像是跟家里有关。从dns解析入手试试，但是不知道为啥google.com不经过dns。发现了，就是因为走v2rayN之后，加密后就看不到啥东西了，就没被捕获，还得研究。还是得有大神帮忙，但是还有点bug，明天看看能不能改，match不太准，bug改改就行。
    2023年12月07日: 今天工作会轻松一点，然后搞修改下网络拦截dll代码。感觉是chrome打开之后立即获取google的dns的原因，有的时候可以拦截，有的时候拦截不到，打算搞一个自动注入。但是不知道为什么minhook，detours，随便哪个dll都不行，好像是chrome有些进程可以，有些不行，我看看只能弄大规模注入了，不用 xenos，而是用我的代码。工作占了很多时间，进度比较慢。今天因为脚气复燃，买东西，老烦了。慢慢来，明天大规模注入。
    2023年12月08日: 工作，今天要好好工作。大规模注入。同事一句话提醒我，用tcp包中的网址来拦截，但是没法真正完全获取域名，所以有可能误杀，比如我在百度搜索google，我如果拦截google，就访问不到，所以还是得思考。找个时间研究一下精确获取域名的方法。
    2023年12月09日: 什么都没干。
    2023年12月10日: 妈的，又啥都没干，光玩游戏了。接下来，进程控制、自动注入。进程拦截（hook create process 啥的），进程隐藏。明天的话综合这些东西，然后做一个demo出来，要投入使用。投入使用后，开始驱动学习。
    2023年12月11日: 大概需要一周整合，投入正常使用，开始！是的，我已经越来越不喜欢现在的公司了。慢慢来吧，在深渊的最深处，凝视黑暗的天空。这个月基本不会休息了。这个月尽量完成我的作品，然后下个月开始正式投入使用。命运的齿轮开始疯狂转动！循环无限注入，之后就是【隐藏窗口 | 隐藏本进程 | 打包所有文件为一个文件】
    2023年12月12日: 今天太忙了，都忘了更新日记，最近病的很重，我还是选择休息吧。
    2023年12月18日: 最近比较忙，没时间学习，一直工作，直到上周五，只是周末又太放纵自己，当然，也跟疾病也有关系，但是这确实不是真正的理由，算是借口吧，是太懒了，不想学习。但没事，慢慢来。又加班，好累啊，我会不会死啊！继续【隐藏窗口 | 隐藏本进程 | 打包所有文件为一个文件】
    
  自动启动:
    2023年12月18日: 最近一直在病，今天就稍微搜集一下资料，粗略的看一下。先搞了一下隐藏窗口和隐藏进程，先大概弄一下，之后就在虚拟机开发了，本机就这样用着。明天继续搞自动启动，把所有的技术都用上。
    2023年12月20日: 昨天心情不好，而且一直病，一直工作。今天发现自动开启后不能看斗鱼啥的，挺好的。可以马上抑制住我的情绪，在虚拟机开发。搞了半天发现dll不好搞，然后慢慢研究打包工具了。。所以明天搞打包工具。
    2023年12月29日: 大概思路是，把所有能挂上的地方都挂一下，然后每秒都检测一下，如果被下了就自动挂上。
    2024年01月01日: 就这样吧，懒得搞。明天把这个实装一下，之后开始搞驱动，防止关闭进程，和一些文件过滤驱动。
    2024年01月02日: 忙碌工作，今天稍微实装一下，就这样先，fakerandroid没了，大概是要收割了。

  打包工具:
    2023年12月20日: 先搜集一下资料。
    2023年12月21日: 忙的要死。
    2023年12月23日: 病的要死。
    2023年12月25日: 吃药，病好了一点，健康第一。
    2023年12月27日: 电脑自动开学习资料，手机到时候直接锁屏，打包工具搞搞。
    2023年12月28日: 打包成了，现在得解决虚拟机和其他电脑不能注入的问题。知道原因了，是没装VS2022和c++环境问题，得好好搞搞。
    2023年12月29日: 解决了，静态链接就行，至此，打包工具已成，该搞自动启动了。

  驱动学习: # 为了解决防止被修改，防止被发现文件在哪里。
    2024年01月03日: 看看视频，巩固基础，减肥。光聊天了，然后下载了点视频，明天看吧。
    2024年01月04日: 看视频，巩固基础，减肥。主要是看了R3和R0通信的过程，R3通过 createFile 触发 IRP，读写内存，R0写文件，创建文件。
    2024年01月05日: 看视频[6]，巩固基础，减肥。删除文件，修改文件属性，cr3和_EPROCESS结构。
    2024年01月06日: 看视频[8]，巩固基础，减肥。看完了，cr0 | PEPROCESS | 一些未公开函数 | wrk源码 | 回调 | 屏蔽中断 | ida分析ntoskrnl | Thread和Process知识，明天开始写一下驱动吧，实现视频中的一些操作，不懂就再看一下视频，先自己写，不懂再看，然后再写。
    2024年01月07日: 亲自下手写，减肥。啥都没写，废了，我真的是个废物，哈哈哈哈！慢慢来吧，开摆！
    2024年01月11日: 不想学习。稍微看了下，网路上大神太多了，加油！
    2024年01月12日: 不想学习，但是听视频会让我想学习。最近几天先搞进程隐藏和R0和R3通信吧。只写到了通信。
    2024年01月13日: 写好完美的通信过程，然后尽量能做到进程隐藏，这周内完成就行。又开始咳嗽了妈的。我知道你想学习，你想自己写，但是这毕竟是不可能的，需要大量的时间和试错，所以我不管你怎么写，你只管写完就写，不管是抄还是什么，学习的事儿以后碰到问题就学，还是先扩展知识面吧，不要再钻牛角尖了。现在写到了PRINT.PROCESS.NAME, 之后再写隐藏进程。隐藏完了，得找下一个目标了。那就文件过滤驱动吧。过滤驱动挺难得，加油吧。
    2024年01月14日: 看视频，大概捋清楚思路，记个笔记吧，明天就先打个地基，下周看看能不能完成大概的文件过滤驱动。下午搞键盘过滤驱动。鼠标过滤驱动不能在 VMWare 下正常运行，然后用了别人的 HOOK 的方法，确实可行，今天就研究一下键盘过滤驱动和鼠标HOOK驱动吧。下周搞文件过滤驱动。搞个屁的文件过滤，先把之前做的键盘过滤驱动给学会把，那玩意简直就是通用。哎，别着急，慢慢来。
    2024年01月15日: 通过书和代码，好好总结键盘驱动和鼠标驱动。下周只搞这个就行。
    2024年01月16日: c2pPower, c2pPnP, c2pUnload 搞懂这些。没事，大概理解就行，没必要死抠，你暂时不会用得到。
    2024年01月17日: IRP_MJ_READ, c2pAttachDevices 搞懂这些。没事，也是大概理解就行，别给自己压力，慢慢来！你可以的！
    2024年01月18日: 磁盘的虚拟大概看看, 后天学习磁盘过滤, 然后之后学完再学文件系统过滤. 磁盘的虚拟不看了, 刚刚看了下, 感觉不重要. 花了点时间看了boss直聘, 其实并不需要看, 努力学习写一个项目才是重要的, 然后今天一直在读代码, DiskFilterDriver 代码太长了... 有点收获, 但还是离目标太过遥远, 加油! 今天吃饭太快了, 细嚼慢咽吧.
    2024年01月19日: Read DiskFilterDriver Code, 差不多读完了就开始写笔记. 还有运动.
    2024年01月20日: 看1h脱壳, 啥都没懂, 还是先学驱动吧.
    2024年01月21日: 我发现我还是被金钱束缚住了, 为了找工作学习理论, 但是理论本来就不好学, 你应该要针对一件事儿, 比如开发出自律神器, 你要瞄准一个点, 直接cv大法又如何, 你在编译, 修改, 调试过程中还是会学到这些理论的, 我相信你的好奇心和好胜心. 所以今天开始, 全力开发自律神器Driver版, 搞了MiniFilter, 最终没安装上, 不知道为什么安装后没效果, 没Log, 然后又想破解软件, 然后还是没啥头绪, 但是知道了那玩意是麻婆安全, 你给我等着, 等我有钱了, 我再全力破解你! DLL EXPORT 获取函数地址为 0, 原因居然是 CPP 导致的! 服辣!
    2024年01月22日: 保持乐观, 保持心态. 项目编译安装测试成功, 开始看代码理解消化记笔记. 准备使用 MiniFilter 实现更加复杂的功能. 开看!
    2024年01月23日: 乐观! WFP代码复制过来, 编译下, 组合 Minifilter 和 WFP 和 KeyBoard 和 Mouse 过滤, 先搞出一个能万能的框架, 然后再用 MFC 框架写一个EXE. 妈的! 跑步去了! 别哭, 我们可以的!
    2024年01月24日: 不想学习...怎么办, 脑子里一片空白..
    2024年01月26日: 昨天玩了一天, 我也要拍视频, 记录每一秒, 或许这样就能学习了? 哈哈哈哈.
    2024年01月27日: 昨天也是玩了一天, 今天也是玩了一天, 还得是逼自己, 不然就没救了. 随便吧, 想干啥干啥, 但是绝对别娱乐. 粗略分析 DiskMiniFilter, 明天编译下 WFP, 然后粗略分析下, 然后跑步.
    2024年01月28日: 今天玩了一天, 晚上才开始学习, 编译了 WFP, 拦截 REMOVE.PORT, 开始阅读源代码. 今天学了俩小时左右, 我不知道是怎么开始学的, 我觉得还是得禁娱乐. 慢慢来吧. 尤其是吃饭的时候, 不能看视频啥的. 哎!
    2024年01月29日: 继续分析源代码. 还是不规划未来了, 先把明天和今天过好. 投了几家, 没回应, 没事, 先不管, 我们好好学习先, 一定可以的, 因为你是天才啊, 加油! WFP 已看完, 明天开始结合 WFP 和 MiniFilter.
    2024年01月30日: 工作上的负面情绪不要带到学习中, 照样到点就下班, 毕竟我是正义的, 我已经很对得起他们了, 所以保持乐观, 回到家就开始搞 WFP 和 Minifilter 的结合, 疯狂写代码! 没写啥, 就是解决了结合问题.
    2024年01月31日: 驱动大融合? 开搞! 但是先要证实一下 MiniFilter. WFP 的话已经证实了. 然后就开始所有 EXE 都融合, 最后就是一整个大炮台!!! 空闲时间学习 Windows R3 编程. 证实完毕, 正式开始大融合. 两个 wdm 融合, unload 的时候发现 minifilter不知道为啥不执行 npunload, 所以自己加上弄好了.
    2024年02月01日: 继续融合. 不融合了, 理论上是可以融合的, 但是浪费时间, 完善 WFP 吧. 蓝屏了, 吃完饭回来修复一下. 修复完毕, 下一个目标是配置文件中读取地址, 然后拦截
    2024年02月04日: 又玩了两天, 罪过罪过, 哎, 慢慢来, 今天继续搞配置文件. 驱动中一直蓝屏, 最后发现是临时变量总是被覆盖, ExAllocatePoolWithTag 用这个开辟空间即可. 下午搞单独加 url和ip地址. 开始搞 MiniFilter, 拦截 Process. 开始隐藏文件和文件夹. 我发现隐藏文件比打不开文件更牛逼.
    2024年02月05日: 隐藏文件, 搬运. 太焦虑了, 只思考当下该做的事儿. 现在要做的就是把隐藏文件的那个移植过来, 先把我的项目完成, 然后研究 PG 和 签名, 让我的驱动运行在我的电脑里.

  Windows 编程: # 学习驱动中发现需要学习这方面的知识，这个粗略经过就行，抽时间先看视频，就不需要专门写练习，写驱动中慢慢学会就行。
    视频:
      当前进度: 1-Windows系统编程-进程基础与相关结构（1）
    书籍:
      Windows Via CC++ [Windows 核心编程]:
        
  下饭学习视频: # 希望能找到一些不需要记笔记，但是可以维持学习脑感的视频。
Reference:
  请问下 Proxifier 的原理是什么?: https://www.zhihu.com/question/296876516
  详解云计算网络底层技术——虚拟网络设备 tap/tun 原理解析: https://cloud.tencent.com/developer/article/1432451
  真-全局代理原理细谈: https://blog.csdn.net/qq_29656325/article/details/125887966
